#!/usr/bin/env php
<?php

declare(strict_types=1);

/*
 * This file is part of the IcuParser package.
 *
 * (c) Younes ENNAJI <younes.ennaji.pro@gmail.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

if (version_compare('8.2.0', \PHP_VERSION, '>')) {
    fwrite(\STDERR, sprintf('This version of IcuParser requires PHP >= 8.2.0.'."\n".'You are using PHP %s (%s).'."\n", \PHP_VERSION, \PHP_BINARY));

    exit(1);
}

gc_disable();

$autoloadPath = null;
$autoloadPaths = [
    __DIR__.'/../vendor/autoload.php',
    __DIR__.'/../../../../vendor/autoload.php',
    __DIR__.'/vendor/autoload.php',
];

foreach ($autoloadPaths as $path) {
    if (file_exists($path)) {
        $autoloadPath = $path;

        break;
    }
}

if (null === $autoloadPath) {
    throw new \RuntimeException('Unable to locate autoload.php file.');
}

require_once $autoloadPath;

use IcuParser\Cli\Application;
use IcuParser\Cli\Command\AuditCommand;
use IcuParser\Cli\Command\DebugCommand;
use IcuParser\Cli\Command\HelpCommand;
use IcuParser\Cli\Command\LintCommand;
use IcuParser\Cli\GlobalOptionsParser;
use IcuParser\Cli\Output;

$globalOptionsParser = new GlobalOptionsParser();
$output = new Output(false, false);
$helpCommand = new HelpCommand();

$app = new Application($globalOptionsParser, $output, $helpCommand);
$app->register($helpCommand);

$debugCommand = new DebugCommand();
$auditCommand = new AuditCommand();
$lintCommand = new LintCommand();

$app->register($debugCommand);
$app->register($auditCommand);
$app->register($lintCommand);

$helpCommand->setCommands([$helpCommand, $debugCommand, $auditCommand, $lintCommand]);

exit($app->run($argv));
